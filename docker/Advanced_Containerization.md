# Advanced Containerization Topics

**Date:** January 18

## 1. Introduction

This detailed guide covers advanced containerization concepts, focusing on orchestration with Docker Compose, networking strategies, and persistent storage management.

## 2. Docker Compose

Docker Compose is a tool for defining and running multi-container Docker applications. It uses a YAML file to configure your application's services.

### Workflow

1.  **Create a `compose.yaml` file**: This file (or `docker-compose.yml`) sits in your project's root directory.
2.  **Execution**: Run the `docker compose up` command.
    - **Parsing**: The Docker Compose CLI parses the YAML file.
    - **Infrastructure**: It creates the necessary networks, volumes, and containers.
    - **Dependencies**: It resolves dependencies between services.
    - **Startup**: It starts the containers in the correct order.
    - **Result**: The application runs as a set of coordinated containers.

> **Tool Tip**: Install the **Docker (ms-azuretools)** extension in VS Code for better syntax highlighting and management.

### Key Commands

- `docker compose up -d`: Starts the containers in **detached mode** (background). You can access your services via the defined ports.
- `docker compose down`: Stops and removes the containers, networks, and images created by `up`.

## 3. Project Configuration

### .dockerignore

Just like `.gitignore`, the `.dockerignore` file tells Docker which files to exclude when building the build context. This prevents unnecessary files from being sent to the Docker daemon, improving build speed and security.

**Common Exclusions:**

```text
.git
node_modules
npm-debug
__pycache__
Dockerfile*
.env*
```

### Networking

Docker handles communication between containers using networks.

- **Port Mapping (`8000:8000`)**:
  - The first port is the **Host Port** (your machine).
  - The second port is the **Container Port** (inside the Docker container).
  - Example: A request to `localhost:8000` is forwarded to port `8000` inside the container.
- **Custom Networks (`networks: app-network`)**:
  - By default, Compose sets up a single network for your app.
  - You only need to define custom networks explicitly (like `app-network`) when you have specific communication requirements between isolated services or projects.
- **Drivers**:
  - `driver: bridge`: The default network driver. It provides a software bridge that allows containers connected to the same bridge network to communicate, while providing isolation from containers not on that network.

## 4. Docker Volumes

A **Docker Volume** is a persistent storage mechanism managed by the Docker Engine. It allows data to survive even if the container is stopped, removed, or crashed. It lives outside the container's lifecycle.

> "The only recommended way to get durable data out of containers."

### Types of Storage

There are three main types of storage mounts in Docker:

1.  **Volumes (Named & Anonymous)**:
    - Stored in a part of the host filesystem which is _managed by Docker_ (`/var/lib/docker/volumes/` on Linux).
    - **Best for**: Persisting data generated by and used by Docker containers (e.g., database storage).
    - _Anonymous_: Created without a specific name.
    - _Named_: Created with a name, easy to reference.

2.  **Bind Mounts**:
    - Maps a specific file or directory on the **host machine** to a file or directory in the **container**.
    - **Best for**: Development environments. You can map your source code folder to the container, so changes on your host are immediately reflected in the container (hot reloading).

3.  **tmpfs Mounts**:
    - Stored in the host system's memory only. Never written to the host's filesystem.
    - **Best for**: Storing sensitive information (like credentials) that you don't want to persist.

## 5. Docker Engine

The **Docker Engine** is the core software that runs and manages containers. It is a client-server application with:

- A server (dockerd daemon).
- APIs (REST API) to talk to the daemon.
- A command-line interface (CLI) client (the `docker` command).

---

## Assignments & Resources

1.  **Task**: Run a Next.js and FastAPI project as coordinated containers using a single `docker-compose.yaml` file.
2.  **Reading**: comprehensive study of the `.dockerignore` file.
3.  **Certification**: **CKA (Certified Kubernetes Administrator)** - A challenging but highly valued exam for software engineers focusing on orchestration.
